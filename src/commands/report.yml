description: Report the status of a job to MS Teams
parameters:
  webhook_url:
    description: The Microsoft Teams Webhook URL.
    type: string
  only_on_fail:
    description: Whether send notification only if previous steps failed
    type: boolean
    default: false
  show_msg:
    description: Show message?
    type: boolean
    default: false
  show_author:
    description: Show author?
    type: boolean
    default: false
steps:
  - run:
      name: Prepare Template
      when: always
      command: <<include(scripts/template.sh)>>

  - run:
      when: always
      name: Setup Environment Variables
      environment:
        WEBHOOK_URL: << parameters.webhook_url >>
        SHOW_MSG: << parameters.show_msg >>
        SHOW_AUTHOR: << parameters.show_author >>
      command: <<include(scripts/env.sh)>>

  - unless:
      condition: << parameters.only_on_fail >>
      steps:
        - run:
            name: Report Build Success
            environment:
              STATUS: "Success"
              COLOR: "14a603"
            command: <<include(scripts/report.sh)>>
            when: on_success
  - run:
      name: Report Build Failure
      environment:
        STATUS: "Failed"
        COLOR: "e2091d"
      command: <<include(scripts/report.sh)>>
      when: on_fail
